# Django Notes + PostgreSQL Lab ğŸ“

A small but realistic lab project where I built:

- A **Django** â€œNotesâ€ app (frontend + backend)
- A **PostgreSQL** database in a **separate Docker container**
- Access to the DB from **DBeaver** on my Windows host
- (On my VM, I also experimented with **Prometheus + Grafana + cAdvisor** to monitor the containers and host)

The goal was to simulate a mini production-like setup and learn how applications, databases, containers, and observability all fit together.

---

## ğŸ“ Project Structure

```text
.
â”œâ”€â”€ docker-compose.yml        # Orchestrates Django + Postgres
â””â”€â”€ web
    â”œâ”€â”€ Dockerfile            # Django app image build instructions
    â”œâ”€â”€ requirements.txt      # Python dependencies (Django + psycopg2)
    â”œâ”€â”€ manage.py
    â”œâ”€â”€ mysite/               # Django project
    â”‚   â”œâ”€â”€ settings.py
    â”‚   â”œâ”€â”€ urls.py
    â”‚   â”œâ”€â”€ wsgi.py
    â”‚   â””â”€â”€ asgi.py
    â””â”€â”€ notes/                # Notes app
        â”œâ”€â”€ models.py
        â”œâ”€â”€ views.py
        â”œâ”€â”€ urls.py
        â”œâ”€â”€ templates/
        â”‚   â””â”€â”€ notes/
        â”‚       â””â”€â”€ home.html
        â””â”€â”€ migrations/
            â””â”€â”€ 0001_initial.py


```

## ğŸš€ Tech Stack:

- Backend / Frontend: Django 5 (Python 3.12)

- Database: PostgreSQL 16 (Docker)

- Orchestration: Docker Compose

- DB Client: DBeaver (from Windows host)

(Outside this repo): Prometheus, Grafana, Node Exporter, cAdvisor on the VM


## ğŸ”§ How to Run

Prerequisites: Docker + Docker Compose installed.

Clone the repo and move into it:
```bash
git clone https://github.com/<your-username>/django-notes-observability-lab.git
cd django-notes-observability-lab

1ï¸âƒ£ Build images
docker compose build

2ï¸âƒ£ Run migrations
docker compose run --rm web python manage.py makemigrations
docker compose run --rm web python manage.py migrate

3ï¸âƒ£ (Optional) Create a superuser
docker compose run --rm web python manage.py createsuperuser

4ï¸âƒ£ Start the stack
docker compose up -d
```

Now:

Django is available at http://localhost:8000

PostgreSQL is listening on localhost:5432


## ğŸ“ The Notes App

Simple â€œNotesâ€ model:

title (string)

body (text)

created_at (timestamp)

The root URL (/) shows:

A form to create a new note

A list of existing notes ordered by created_at (newest first)

Template: web/notes/templates/notes/home.html.

ğŸ—ƒ Connecting from DBeaver (Host â†’ Container DB)

You can connect to PostgreSQL from your host machine (e.g., Windows with DBeaver):

Connection settings:
```bash
Host: localhost (or VM IP if running on a separate VM)

Port: 5432

Database: demo_db

User: demo_user

Password: demo_pass
```
These values come from docker-compose.yml:
```bash
environment:
  POSTGRES_DB: demo_db
  POSTGRES_USER: demo_user
  POSTGRES_PASSWORD: demo_pass

Example insert from SQL:
INSERT INTO public.notes_note (title, body, created_at)
VALUES ('From DBeaver', 'Sample text from SQL script', NOW());
```

- The id column is auto-generated by PostgreSQL, so we intentionally donâ€™t specify it in the INSERT.

## ğŸ› Issues I Faced (And What I Learned)

1ï¸âƒ£ django.db.utils.ProgrammingError: relation "notes_note" does not exist

- Cause: I forgot to run migrations after creating the Note model.

- Fix:
```bash
docker compose run --rm web python manage.py makemigrations notes
docker compose run --rm web python manage.py migrate
```
2ï¸âƒ£ Wrong timestamps (UTC vs IST)

- By default, Django uses UTC. I wanted IST (Asia/Kolkata).

- In mysite/settings.py:
```bash
TIME_ZONE = "Asia/Kolkata"
USE_TZ = True
```
3ï¸âƒ£ DBeaver timezone error

- PostgreSQL didnâ€™t like the old alias Asia/Calcutta when connecting via DBeaver.

- Fix: Set the timezone to Asia/Kolkata in DBeaverâ€™s preferences / connection settings.

4ï¸âƒ£ Inserting into created_at from SQL

- The model uses:

- created_at = models.DateTimeField(auto_now_add=True)


- Django fills this automatically in the ORM, but PostgreSQL has a NOT NULL constraint and no DB default, so raw inserts like:
```bash
INSERT INTO public.notes_note (title, body)
VALUES ('Test', 'Some text');
```

will fail.

Fix options:
```bash
Provide created_at in SQL (using NOW()), or

Add a DB default:

ALTER TABLE public.notes_note
ALTER COLUMN created_at SET DEFAULT NOW();
```
## ğŸ“Š Monitoring (Configured on the VM, not in this repo)

- On my VM (outside this repo), I also set up:

- Prometheus scraping:

- node_exporter for host metrics

- cadvisor for Docker container metrics

- Grafana dashboards for:

- VM CPU, RAM, Disk, Load

- Per-container CPU, Memory, Network

Example cadvisor Docker run command used on the VM:

```bash
docker run -d \
  --name=cadvisor \
  --privileged \
  --restart=unless-stopped \
  -p 8081:8080 \
  -v /:/rootfs:ro \
  -v /var/run:/var/run:rw \
  -v /sys:/sys:ro \
  -v /var/lib/docker/:/var/lib/docker:ro \
  -v /var/run/docker.sock:/var/run/docker.sock:ro \
  gcr.io/cadvisor/cadvisor:v0.47.0

```
This gave me live observability into the demo-django and demo-postgres containers.

## ğŸ¯ What I Learned

- Dockerizing a Django + Postgres app

- Using Docker Compose for a multi-container stack

- Handling database migrations & constraints

- Connecting external tools (DBeaver) to containerized DBs

- Basic observability with Prometheus + Grafana + cAdvisor

- Reading and solving real errors from logs (Django, Postgres, Docker)

## ğŸ“Œ Future Ideas

- Add PostgreSQL exporter for deeper DB metrics

- Add Django Prometheus client for app-level metrics

- Serve Django via Gunicorn + Nginx

- Deploy the whole setup to a cloud VM (AWS EC2, etc.)


---
